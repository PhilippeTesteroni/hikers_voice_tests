# Hiker's Voice - –°–∏—Å—Ç–µ–º–∞ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## –§–∏–ª–æ—Å–æ—Ñ–∏—è –ø—Ä–æ–µ–∫—Ç–∞

–ú–∏–Ω–∏–º—É–º —É—Å–ª–æ–∂–Ω–µ–Ω–∏—è, –º–∞–∫—Å–∏–º—É–º —è—Å–Ω–æ—Å—Ç–∏. –¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ—Å—Ç—ã–º–∏, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º–∏ –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –ø—É—à–µ–º –≤ –ø—Ä–æ–¥. –ù–∏–∫–∞–∫–∏—Ö –ª–∏—à–Ω–∏—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π –∏ –ø–µ—Ä–µ—É—Å–ª–æ–∂–Ω–µ–Ω–∏–π.

## –°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–æ–≤ ‚úÖ

| –¢–µ—Å—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª |
|------|----------|--------|------|
| TEST-001 | –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞ –Ω–∞ –∫–æ–º–ø–∞–Ω–∏—é —Å –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–æ–º | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | `test_reviews.py::test_create_company_review_with_autocomplete` |
| TEST-002 | –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞ –Ω–∞ –≥–∏–¥–∞ —Å –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–æ–º | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | `test_reviews.py::test_create_guide_review_with_autocomplete` |
| TEST-004 | –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –æ—Ç–∑—ã–≤–∞ (–∫–æ–º–ø–∞–Ω–∏—è –∏ –≥–∏–¥) | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | `test_reviews.py::test_review_form_validation_errors` |
| TEST-005 | –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ –æ—Ç–∑—ã–≤—ã | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | `test_photo_upload.py::test_review_with_photos` |
| TEST-006 | –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–∞ –∫–æ–º–ø–∞–Ω–∏–∏ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | `test_companies.py::test_duplicate_company_detection_and_navigation` |
| TEST-007 | –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–∞ –≥–∏–¥–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | `test_guides.py::test_duplicate_guide_detection_and_navigation` |
| TEST-008 | –°–æ–∑–¥–∞–Ω–∏–µ –≥–∏–¥–∞ –±–µ–∑ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | `test_guides.py::test_create_guide_same_name_no_country_overlap` |
| TEST-009 | Lookup –≥–∏–¥–æ–≤ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | `test_lookup.py::test_guide_lookup_extended_info` |

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
hikers_voice_tests/
‚îú‚îÄ‚îÄ conftest.py              # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
‚îú‚îÄ‚îÄ pytest.ini               # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ pytest
‚îú‚îÄ‚îÄ requirements.txt         # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ
‚îú‚îÄ‚îÄ pages/                   # Page Objects
‚îÇ   ‚îú‚îÄ‚îÄ base_page.py        # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Å wait/click/fill –º–µ—Ç–æ–¥–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ home_page.py        # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ company_page.py     # –ö–æ–º–ø–∞–Ω–∏–∏ (—Å–ø–∏—Å–æ–∫, –¥–µ—Ç–∞–ª–∏, —Å–æ–∑–¥–∞–Ω–∏–µ, –¥—É–±–ª–∏–∫–∞—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ guide_page.py       # –ì–∏–¥—ã (—Å–ø–∏—Å–æ–∫, –¥–µ—Ç–∞–ª–∏, —Å–æ–∑–¥–∞–Ω–∏–µ, –¥—É–±–ª–∏–∫–∞—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ review_form_page.py # –§–æ—Ä–º—ã –æ—Ç–∑—ã–≤–æ–≤ + –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç—ã + —Ñ–æ—Ç–æ
‚îÇ   ‚îî‚îÄ‚îÄ reviews_page.py     # –°–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤ + lightbox
‚îÇ
‚îú‚îÄ‚îÄ tests/                   # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py         # E2E —Ñ–∏–∫—Å—Ç—É—Ä—ã (browser, clean_test_*)
‚îÇ   ‚îú‚îÄ‚îÄ test_reviews.py     # TEST-001, 002, 004
‚îÇ   ‚îú‚îÄ‚îÄ test_photo_upload.py # TEST-005
‚îÇ   ‚îú‚îÄ‚îÄ test_companies.py   # TEST-006
‚îÇ   ‚îú‚îÄ‚îÄ test_guides.py      # TEST-007, 008
‚îÇ   ‚îî‚îÄ‚îÄ test_lookup.py      # TEST-009
‚îÇ
‚îú‚îÄ‚îÄ fixtures/                # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îú‚îÄ‚îÄ test_data.py        # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ test_images_fixtures.py
‚îÇ   ‚îî‚îÄ‚îÄ test_images/        # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚îÇ
‚îî‚îÄ‚îÄ utils/                   # –£—Ç–∏–ª–∏—Ç—ã
    ‚îú‚îÄ‚îÄ test_helper.py      # API —Ö–µ–ª–ø–µ—Ä—ã (–º–æ–¥–µ—Ä–∞—Ü–∏—è, —É–¥–∞–ª–µ–Ω–∏–µ)
    ‚îú‚îÄ‚îÄ rating_calculator.py
    ‚îî‚îÄ‚îÄ image_generator.py
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Page Object Pattern
- –í—Å–µ UI –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ Page Objects
- `BasePage` - –±–∞–∑–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã wait/click/fill
- –°–µ–ª–µ–∫—Ç–æ—Ä—ã –∫–∞–∫ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫–ª–∞—Å—Å–∞
- –ú–µ—Ç–æ–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –¥–∞–Ω–Ω—ã–µ, –Ω–µ –¥–µ–ª–∞—é—Ç assert

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ç–µ—Å—Ç–æ–≤
1. **AAA –ø–∞—Ç—Ç–µ—Ä–Ω** - Arrange, Act, Assert
2. **–õ–∏–Ω–µ–π–Ω–æ—Å—Ç—å** - –Ω–µ—Ç –≤–µ—Ç–≤–ª–µ–Ω–∏–π –∫—Ä–æ–º–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–∏
3. **Cleanup —á–µ—Ä–µ–∑ —Ñ–∏–∫—Å—Ç—É—Ä—ã** - `clean_test_review`, `clean_test_guide`
4. **–ù–∏–∫–∞–∫–∏—Ö time.sleep()** - —Ç–æ–ª—å–∫–æ Playwright wait_for_*
5. **–ü–æ–Ω—è—Ç–Ω—ã–µ assert —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏**

### Cleanup —Å–∏—Å—Ç–µ–º–∞
```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π cleanup —á–µ—Ä–µ–∑ —Ñ–∏–∫—Å—Ç—É—Ä—ã
async def test_something(clean_test_guide: list):
    created_id = await create_guide()
    clean_test_guide.append(created_id)  # –£–¥–∞–ª–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    # –¢–µ—Å—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è...
# –í teardown —Ñ–∏–∫—Å—Ç—É—Ä–∞ —É–¥–∞–ª–∏—Ç –≤—Å–µ –≥–∏–¥—ã –∏–∑ —Å–ø–∏—Å–∫–∞
```

**–í–∞–∂–Ω–æ:** Cleanup –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–∏–∫—Å—Ç—É—Ä–∞—Ö, –ù–ï –≤ —Ç–µ–ª–µ —Ç–µ—Å—Ç–∞. –ï—Å–ª–∏ cleanup –ø–∞–¥–∞–µ—Ç - —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –º—É—Å–æ—Ä–∞).

### –§–∏–∫—Å—Ç—É—Ä—ã

#### Browser —Ñ–∏–∫—Å—Ç—É—Ä—ã
- `page` - Playwright Page —Å viewport 1920x1080
- `browser_context` - –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `--headless`, `--slow-mo=N`

#### Cleanup —Ñ–∏–∫—Å—Ç—É—Ä—ã
```python
@pytest_asyncio.fixture
async def clean_test_review(backend_url: str):
    """–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏ —É–¥–∞–ª—è–µ—Ç –æ—Ç–∑—ã–≤—ã –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞"""
    review_ids = []
    yield review_ids
    # Cleanup –≤ teardown

@pytest_asyncio.fixture
async def clean_test_guide(backend_url: str):
    """–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏ —É–¥–∞–ª—è–µ—Ç –≥–∏–¥–æ–≤ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞"""
    guide_ids = []
    yield guide_ids
    # Cleanup –≤ teardown
```

#### Data —Ñ–∏–∫—Å—Ç—É—Ä—ã
- `review_test_data` - –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `test_images` - —Å–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π –∫ 7 —Ç–µ—Å—Ç–æ–≤—ã–º —Ñ–æ—Ç–æ
- `api_client` - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤

## –°–µ–ª–µ–∫—Ç–æ—Ä—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

1. `data-testid` ‚úÖ
2. `id` 
3. –£–Ω–∏–∫–∞–ª—å–Ω—ã–π `className`
4. `name` (—Ñ–æ—Ä–º—ã)
5. `text` (–ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç)

```python
# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
SUBMIT = "[data-testid='submit-review']"
EMAIL = "input[name='email']"
BUTTON = "text=–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤"
ALERT = ".alert-success"
```

## –†–∞–±–æ—Ç–∞ —Å –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–∞–º–∏

–í—Å–µ –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç debounce 300ms:

```python
async def type_and_wait_dropdown(self, text: str):
    await input.click()  # –¢—Ä–∏–≥–≥–µ—Ä onFocus
    await self.page.wait_for_timeout(300)
    await input.type(text, delay=100)
    await self.page.wait_for_timeout(500)  # Debounce + API
    await self.page.wait_for_selector(DROPDOWN, state="visible")
```

**–í–∞–∂–Ω–æ:** 
- –ö–ª–∏–∫ –ø–µ—Ä–µ–¥ –≤–≤–æ–¥–æ–º (—Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç `onFocus`)
- –û–∂–∏–¥–∞–Ω–∏–µ debounce + –≤—Ä–µ–º—è –Ω–∞ API
- `state="visible"` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest tests/ -v

# –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
pytest tests/test_reviews.py -v      # –û—Ç–∑—ã–≤—ã
pytest tests/test_guides.py -v       # –ì–∏–¥—ã
pytest tests/test_lookup.py -v       # Lookup

# –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π - –æ–¥–∏–Ω —Å—Ü–µ–Ω–∞—Ä–∏–π
pytest tests/test_lookup.py -k "guide_review" -v

# –ö—Ä–∏—Ç–∏—á–Ω—ã–µ
pytest -m critical

# –° –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
pytest tests/ --slow-mo=500

# Headless (CI)
pytest tests/ --headless
```

## –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è

1. **Backend:** http://localhost:8000 (APP_ENV=dev)
2. **Frontend:** http://localhost:3000  
3. **Seed –¥–∞–Ω–Ω—ã–µ:**
   - –ì–∏–¥ "–ì–µ–æ—Ä–≥–∏–π –ß–µ–ª–∏–¥–∑–µ" (id=1) + –∫–æ–Ω—Ç–∞–∫—Ç—ã + —Å—Ç—Ä–∞–Ω—ã GE/AM
   - –ö–æ–º–ø–∞–Ω–∏–∏ —Å "Svaneti"
   - –ú–∏–Ω–∏–º—É–º 1 –∫–æ–º–ø–∞–Ω–∏—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
4. `pip install -r requirements.txt`
5. `python utils/image_generator.py`

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### TEST-001, 002: –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤
- –û—Ç–∑—ã–≤—ã –Ω–∞ –∫–æ–º–ø–∞–Ω–∏–∏/–≥–∏–¥–æ–≤ —Å –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–æ–º
- –ú–æ–¥–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ API
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
- –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ (TEST-002)
- **Cleanup:** `clean_test_review` —Ñ–∏–∫—Å—Ç—É—Ä–∞

### TEST-004: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è:** company/guide

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –ø—É—Å—Ç–æ–π —Ñ–æ—Ä–º–µ
- –î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ 10-4000 —Å–∏–º–≤–æ–ª–æ–≤
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –ø–æ–ª–µ–π
- –ß–µ–∫–±–æ–∫—Å –ø—Ä–∞–≤–∏–ª

### TEST-005: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è:** 4 –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (company/guide √ó 1/5 —Ñ–æ—Ç–æ)

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- –ü—Ä–µ–≤—å—é –≤ —Ñ–æ—Ä–º–µ
- –§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ç–∑—ã–≤–∞
- Lightbox (–æ—Ç–∫—Ä—ã—Ç–∏–µ, –Ω–∞–≤–∏–≥–∞—Ü–∏—è, –∑–∞–∫—Ä—ã—Ç–∏–µ)
- **Cleanup:** `clean_test_review` —Ñ–∏–∫—Å—Ç—É—Ä–∞

### TEST-006: –î—É–±–ª–∏–∫–∞—Ç –∫–æ–º–ø–∞–Ω–∏–∏
**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- Warning –ø—Ä–∏ –¥—É–±–ª–∏–∫–∞—Ç–µ (HTTP 409)
- –ö–Ω–æ–ø–∫–∏: "–ü–µ—Ä–µ–π—Ç–∏" / "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞"
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–º–ø–∞–Ω–∏–∏

### TEST-007: –î—É–±–ª–∏–∫–∞—Ç –≥–∏–¥–∞
**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è:** go_to_existing/create_new

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- Warning –ø—Ä–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω
- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- –ù–∞–≤–∏–≥–∞—Ü–∏—è (—Å—Ü–µ–Ω–∞—Ä–∏–π A)
- Force create + cleanup (—Å—Ü–µ–Ω–∞—Ä–∏–π B)
- **Cleanup:** `clean_test_guide` —Ñ–∏–∫—Å—Ç—É—Ä–∞

### TEST-008: –ì–∏–¥ –±–µ–∑ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω
**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- Warning –ù–ï –ø–æ—è–≤–ª—è–µ—Ç—Å—è (—Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã)
- –£—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≥–∏–¥–∞
- **Cleanup:** `clean_test_guide` —Ñ–∏–∫—Å—Ç—É—Ä–∞

### TEST-009: Lookup —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è:** guide_review/company_review

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- –°–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª—è –≥–∏–¥–∞ (TR)
- Dropdown –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 2+ –≥–∏–¥–æ–≤
- –§–æ—Ä–º–∞—Ç: –ò–º—è + üåç –°—Ç—Ä–∞–Ω—ã [‚Ä¢ –∫–æ–Ω—Ç–∞–∫—Ç/—Ä–µ–π—Ç–∏–Ω–≥]
- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- **Cleanup:** `clean_test_guide` —Ñ–∏–∫—Å—Ç—É—Ä–∞

## –†–µ—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. Lightbox - –¥–≤–æ–π–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
Mobile –∫–Ω–æ–ø–∫–∏ (hidden) –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å –ø–µ—Ä–≤—ã–º–∏

**–†–µ—à–µ–Ω–∏–µ:** `.sm\\:block` –¥–ª—è desktop –≤–µ—Ä—Å–∏–∏

### 2. wait_for_review_form() –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª –≥–∏–¥–æ–≤
–í—Å–µ–≥–¥–∞ –∂–¥–∞–ª COMPANY_NAME_INPUT

**–†–µ—à–µ–Ω–∏–µ:** –ü–∞—Ä–∞–º–µ—Ç—Ä `review_type`

### 3. Dropdown –Ω–µ –ø–æ—è–≤–ª—è–ª—Å—è
–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä + –Ω–µ—Ç debounce + –Ω–µ—Ç –∫–ª–∏–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –°–µ–ª–µ–∫—Ç–æ—Ä: `div.absolute.z-10[class*='bg-']`
- –ö–ª–∏–∫ –ø–µ—Ä–µ–¥ –≤–≤–æ–¥–æ–º
- –û–∂–∏–¥–∞–Ω–∏–µ 500ms (debounce + API)
- `state="visible"`

### 4. –†–∞–∑–Ω—ã–µ input –¥–ª—è lookup
`GuideAutocomplete` vs `GuidesSelector` - —Ä–∞–∑–Ω—ã–µ placeholder

**–†–µ—à–µ–Ω–∏–µ:** –ü–∞—Ä–∞–º–µ—Ç—Ä `form_type` –≤ –º–µ—Ç–æ–¥–µ

### 5. Cleanup –≤ —Ç–µ–ª–µ —Ç–µ—Å—Ç–∞
Cleanup –±—ã–ª –≤ try/finally –±–ª–æ–∫–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:** –§–∏–∫—Å—Ç—É—Ä—ã `clean_test_review` / `clean_test_guide`

## –ß–µ–∫–ª–∏—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–∞

- [ ] –°–µ–ª–µ–∫—Ç–æ—Ä—ã –∏–∑ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞?
- [ ] –°–µ–ª–µ–∫—Ç–æ—Ä—ã –∫–∞–∫ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ Page Object?
- [ ] –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–µ—Ç–æ–¥—ã –∏–∑ BasePage?
- [ ] –ú–∞—Ä–∫–µ—Ä—ã `@pytest.mark.e2e`, `@pytest.mark.critical`?
- [ ] –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ñ–∏–∫—Å—Ç—É—Ä—ã cleanup?
- [ ] –ü–æ–Ω—è—Ç–Ω—ã–µ assert —Å–æ–æ–±—â–µ–Ω–∏—è?
- [ ] –¢–µ—Å—Ç –ª–∏–Ω–µ–π–Ω—ã–π (–Ω–µ—Ç fallback)?
- [ ] –ù–µ—Ç `time.sleep()`?

## –û—Ç–ª–∞–¥–∫–∞

| –û—à–∏–±–∫–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|
| Dropdown –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è | `await input.click()` –ø–µ—Ä–µ–¥ –≤–≤–æ–¥–æ–º |
| Timeout –Ω–∞ —Å–µ–ª–µ–∫—Ç–æ—Ä | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ DevTools |
| Cleanup –ø–∞–¥–∞–µ—Ç | APP_ENV=dev –≤ backend |
| ModuleNotFoundError PIL | `pip install Pillow` |

```bash
# Debug –∫–æ–º–∞–Ω–¥—ã
pytest tests/test_guides.py --slow-mo=1000 -v
pytest tests/test_lookup.py -k "company" -v
PLAYWRIGHT_DEBUG=1 pytest tests/test_guides.py -v
```

---

**–í–µ—Ä—Å–∏—è:** 2.0.0  
**–î–∞—Ç–∞:** 02.10.2025  
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:** –†–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ + cleanup —á–µ—Ä–µ–∑ —Ñ–∏–∫—Å—Ç—É—Ä—ã
